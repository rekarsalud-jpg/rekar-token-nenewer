name: 🔄 Renovar Token Meta

on:
  schedule:
    # Cada 50 días (aprox 7 semanas)
    - cron: "0 9 */50 * *"
  workflow_dispatch: # Permite correrlo manualmente también

jobs:
  renew-token:
    runs-on: ubuntu-latest

    steps:
    - name: 🧩 Clonar repositorio
      uses: actions/checkout@v3

    - name: 🐍 Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"

    - name: 📦 Instalar dependencias
      run: |
        pip install requests

    - name: 🔐 Ejecutar script de renovación
      run: python renew_token.py

    - name: 📤 Subir token renovado
      uses: actions/upload-artifact@v3
      with:
        name: new_token
        path: new_token.txt

    - name: 📧 Enviar notificación por correo si falla
      if: failure()
      run: |
        echo "⚠️ Error al renovar token Meta." > message.txt
        echo "Verificá el log del workflow." >> message.txt
        cat message.txt
